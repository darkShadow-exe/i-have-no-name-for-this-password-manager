{% extends "base.html" %}

{% block content %}
    <h1 class="header">Password Manager</h1>
    
    <div class="nav">
        <a href="{{ url_for('add_account') }}">Add New Account</a>
    </div>

    <div class="search-form">
        <form action="{{ url_for('index') }}" method="GET">
            <input type="text" name="q" placeholder="Search by website or username..." value="{{ search_query or '' }}">
            <button type="submit">Search</button>
            {% if search_query %}
                <a href="{{ url_for('index') }}" style="margin-left: 10px; padding: 8px 15px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 3px;">Clear</a>
            {% endif %}
        </form>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if search_query %}
        <div style="text-align: center; margin-bottom: 15px; color: #666;">
            <strong>Search results for: "{{ search_query }}"</strong>
            ({{ accounts|length }} account{{ 's' if accounts|length != 1 else '' }} found)
        </div>
    {% endif %}

    {% if accounts %}
        <table>
            <thead>
                <tr>
                    <th>Website</th>
                    <th>Username</th>
                    <th>Password</th>
                    <th>Notes</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for account in accounts %}
                    <tr>
                        <td>{{ account.website }}</td>
                        <td>{{ account.username }}</td>
                        <td>
                            <div class="password-field">
                                <input type="password" id="pwd-{{ account.id }}" class="password-display" value="••••••••••••••••" readonly>
                                <button type="button" class="btn-small" data-account-id="{{ account.id }}" onclick="togglePasswordView(this.dataset.accountId)">Show</button>
                                <button type="button" class="btn-small btn-warning" data-account-id="{{ account.id }}" onclick="copyPassword(this.dataset.accountId)">Copy</button>
                            </div>
                        </td>
                        <td>{{ account.notes[:50] }}{% if account.notes|length > 50 %}...{% endif %}</td>
                        <td>{{ account.created_at[:10] }}</td>
                        <td class="actions">
                            <a href="{{ url_for('edit_account', account_id=account.id) }}" class="edit-btn">Edit</a>
                            <a href="{{ url_for('delete_account', account_id=account.id) }}" 
                               class="delete-btn" 
                               onclick="return confirm('Are you sure you want to delete this account?')">Delete</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="no-accounts">
            <h3>No accounts stored yet</h3>
            <p><a href="{{ url_for('add_account') }}">Add your first account</a></p>
        </div>
    {% endif %}
{% endblock %}